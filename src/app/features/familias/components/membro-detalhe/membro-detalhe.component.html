<div class="detalhe-page">
    <!-- Page Header -->
    <div class="page-header">
        <div class="page-header-info">
            <div class="member-avatar-large">
                {{ memberInitials }}
            </div>
            <div>
                <h1>{{ memberName || 'Detalhes do Membro' }}</h1>
                <p>Visualize transa√ß√µes e an√°lise financeira deste membro</p>
            </div>
        </div>
        <a routerLink="../../" class="btn-back">
            ‚Üê Voltar
        </a>
    </div>

    <!-- Tab Navigation -->
    <div class="tabs-container">
        <div class="tabs">
            <button class="tab-btn" [class.active]="activeTab === 'transacoes'" (click)="activeTab = 'transacoes'">
                üìã Transa√ß√µes
            </button>
            <button class="tab-btn" [class.active]="activeTab === 'analise'" (click)="activeTab = 'analise'">
                üìä An√°lise
            </button>
        </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="section-card">
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <p class="loading-text">Carregando dados do membro...</p>
        </div>
    </div>

    <ng-container *ngIf="!loading">
        <!-- ==================== TAB: TRANSA√á√ïES ==================== -->
        <div *ngIf="activeTab === 'transacoes'">
            <!-- Quick Metrics -->
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-icon" style="background: #dbeafe;">üìä</div>
                    <div class="metric-value">{{ transacoes.length }}</div>
                    <div class="metric-label">Total de Transa√ß√µes</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon" style="background: #fee2e2;">üí∏</div>
                    <div class="metric-value red">{{ totalDespesas | currency:'BRL' }}</div>
                    <div class="metric-label">Total Despesas</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon" style="background: #dcfce7;">üí∞</div>
                    <div class="metric-value green">{{ totalReceitas | currency:'BRL' }}</div>
                    <div class="metric-label">Total Receitas</div>
                </div>
            </div>

            <!-- Transactions Table -->
            <div class="section-card">
                <h2><span class="icon">üìã</span> Transa√ß√µes Recentes</h2>

                <div class="transactions-table-container" *ngIf="transacoes.length > 0">
                    <table class="transactions-table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Descri√ß√£o</th>
                                <th>Categoria</th>
                                <th style="text-align: right;">Valor</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let t of transacoes">
                                <td class="transaction-date">{{ t.data | date:'dd/MM/yyyy' }}</td>
                                <td class="transaction-description">{{ t.descricao }}</td>
                                <td>
                                    <span class="transaction-category">
                                        {{ getCategoryIcon(t.categoria) }} {{ getCategoryLabel(t.categoria) }}
                                    </span>
                                </td>
                                <td class="transaction-value" [class.despesa]="isDespesa(t.tipo)"
                                    [class.receita]="isReceita(t.tipo)">
                                    {{ isDespesa(t.tipo) ? '-' : '+' }}{{ t.valorOriginal | currency:t.moedaOriginal
                                    }}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="empty-state" *ngIf="transacoes.length === 0">
                    <div class="icon">üìã</div>
                    <p>Nenhuma transa√ß√£o encontrada</p>
                </div>
            </div>
        </div>

        <!-- ==================== TAB: AN√ÅLISE ==================== -->
        <div *ngIf="activeTab === 'analise'">
            <ng-container *ngIf="analise">
                <!-- Investments Section (if any) -->
                <div class="section-card investments-card" *ngIf="analise.totalInvestimentos > 0">
                    <h2><span class="icon">üíé</span> Investimentos</h2>
                    <div class="investments-grid">
                        <div class="investment-metric">
                            <span class="label">Total Investido</span>
                            <span class="value">{{ analise.totalInvestimentos | currency:'BRL' }}</span>
                            <span class="sublabel">{{ analise.quantidadeInvestimentos }} aportes</span>
                        </div>
                        <div class="investment-metric">
                            <span class="label">Ticket M√©dio</span>
                            <span class="value">{{ analise.ticketMedioInvestimentos | currency:'BRL' }}</span>
                            <span class="sublabel">por aporte</span>
                        </div>
                    </div>
                </div>

                <!-- Main Metrics -->
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-icon" style="background: #fee2e2;">üí∏</div>
                        <div class="metric-value red">{{ analise.totalGeral | currency:'BRL' }}</div>
                        <div class="metric-label">Total de Despesas</div>
                        <div class="metric-sublabel">{{ analise.periodo }}</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon" style="background: #fef3c7;">üìä</div>
                        <div class="metric-value">{{ analise.quantidadeTransacoes }}</div>
                        <div class="metric-label">Transa√ß√µes</div>
                        <div class="metric-sublabel">No per√≠odo</div>
                    </div>
                </div>

                <!-- Category Breakdown -->
                <div class="section-card">
                    <h2><span class="icon">üè∑Ô∏è</span> Despesas por Categoria</h2>

                    <div class="category-grid"
                        *ngIf="analise.resumoPorCategoria && analise.resumoPorCategoria.length > 0">
                        <div class="category-card" *ngFor="let cat of analise.resumoPorCategoria">
                            <div class="category-icon" [style.background]="getCategoryBgColor(cat.categoria)">
                                {{ getCategoryIcon(cat.categoria) }}
                            </div>
                            <div class="category-info">
                                <span class="category-name">{{ getCategoryLabel(cat.categoria) }}</span>
                                <span class="category-count">{{ cat.quantidade }} transa√ß√µes</span>
                            </div>
                            <div class="category-values">
                                <span class="category-total">{{ cat.total | currency:'BRL' }}</span>
                                <div class="category-details-row">
                                    <span class="category-ticket">TM: {{ cat.ticketMedio | currency:'BRL' }}</span>
                                    <span class="category-percent" [style.color]="getCategoryColor(cat.categoria)">
                                        {{ cat.percentual | number:'1.0-0' }}%
                                    </span>
                                </div>
                            </div>
                            <div class="category-bar-container">
                                <div class="category-bar" [style.width.%]="cat.percentual"
                                    [style.background]="getCategoryColor(cat.categoria)">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="empty-state"
                        *ngIf="!analise.resumoPorCategoria || analise.resumoPorCategoria.length === 0">
                        <div class="icon">üè∑Ô∏è</div>
                        <p>Nenhuma despesa por categoria no per√≠odo</p>
                    </div>
                </div>

                <!-- Monthly Evolution -->
                <div class="section-card" *ngIf="monthlyData.length > 0">
                    <h2><span class="icon">üìà</span> Evolu√ß√£o Mensal</h2>
                    <div class="monthly-chart">
                        <div class="month-bar" *ngFor="let month of monthlyData"
                            [title]="month.label + ': ' + (month.value | currency:'BRL')">
                            <div class="bar-fill" [style.height.%]="month.percentage"></div>
                            <div class="month-label">{{ month.shortLabel }}</div>
                            <div class="month-value">{{ month.value | currency:'BRL':'symbol':'1.0-0' }}</div>
                        </div>
                    </div>
                </div>
            </ng-container>

            <div class="empty-state" *ngIf="!analise">
                <div class="icon">üìä</div>
                <p>Dados de an√°lise n√£o dispon√≠veis</p>
            </div>
        </div>
    </ng-container>
</div>