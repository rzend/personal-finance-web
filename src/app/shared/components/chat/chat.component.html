<!-- Floating Chat Button -->
<button class="chat-toggle" (click)="toggleChat()" [class.open]="isOpen">
    <span class="chat-icon" *ngIf="!isOpen">ğŸ’¬</span>
    <span class="close-icon" *ngIf="isOpen">âœ•</span>
</button>

<!-- Chat Window -->
<div class="chat-window" [class.open]="isOpen">
    <!-- Header -->
    <div class="chat-header">
        <div class="header-info">
            <span class="bot-avatar">ğŸ¤–</span>
            <div>
                <h3>FinBot</h3>
                <span class="status">Assistente Financeiro</span>
            </div>
        </div>
        <div class="header-actions">
            <button class="btn-clear" (click)="clearHistory()" title="Limpar histÃ³rico">
                ğŸ—‘ï¸
            </button>
        </div>
    </div>

    <!-- Messages -->
    <div class="chat-messages" #messagesContainer>
        <!-- Welcome message -->
        <div class="message assistant" *ngIf="messages.length === 0">
            <div class="message-avatar">ğŸ¤–</div>
            <div class="message-content">
                <p>OlÃ¡! ğŸ‘‹ Sou o <strong>FinBot</strong>, seu assistente financeiro pessoal.</p>
                <p>Posso ajudar com:</p>
                <ul>
                    <li>ğŸ“Š AnÃ¡lise das suas finanÃ§as</li>
                    <li>ğŸ’¡ Dicas de economia</li>
                    <li>ğŸ“ˆ SugestÃµes de investimento</li>
                    <li>â“ DÃºvidas sobre a aplicaÃ§Ã£o</li>
                </ul>
                <p>Como posso ajudar vocÃª hoje?</p>
            </div>
        </div>

        <!-- Chat messages -->
        <div *ngFor="let msg of messages" class="message" [class.user]="msg.role === 'user'"
            [class.assistant]="msg.role === 'assistant'">
            <div class="message-avatar" *ngIf="msg.role === 'assistant'">ğŸ¤–</div>
            <div class="message-content">
                <p>{{ msg.content }}</p>
                <span class="message-time">
                    {{ msg.criadoEm | date:'HH:mm' }}
                </span>
            </div>
            <div class="message-avatar user-avatar" *ngIf="msg.role === 'user'">ğŸ‘¤</div>
        </div>

        <!-- Typing indicator -->
        <div class="message assistant typing" *ngIf="isLoading">
            <div class="message-avatar">ğŸ¤–</div>
            <div class="message-content">
                <div class="typing-indicator">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Input -->
    <div class="chat-input">
        <textarea #messageInput [(ngModel)]="newMessage" (keypress)="handleKeyPress($event)"
            placeholder="Digite sua mensagem..." [disabled]="isLoading" rows="1"></textarea>
        <button class="btn-send" (click)="sendMessage()" [disabled]="!newMessage.trim() || isLoading">
            <span *ngIf="!isLoading">â¤</span>
            <span *ngIf="isLoading" class="spinner"></span>
        </button>
    </div>
</div>